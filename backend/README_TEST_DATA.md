# Тестовые данные для TravelAI Backend

Этот набор файлов содержит инструменты для загрузки тестовых данных в базу данных через API endpoints.

## Файлы

1. **`test_data_loader.py`** - Python скрипт для автоматической загрузки всех тестовых данных
2. **`curl_test_commands.sh`** - Bash скрипт с curl командами для полного тестирования
3. **`quick_test_commands.md`** - Отдельные curl команды для быстрого тестирования

## Предварительные требования

1. **Запущенный FastAPI сервер** на `http://127.0.0.1:8000`
2. **Redis сервер** (для кэширования)
3. **Python 3.7+** (для Python скрипта)
4. **curl** (для bash скрипта)

## Быстрый старт

### Вариант 1: Python скрипт (рекомендуется)

```bash
cd TravelAI/backend
python test_data_loader.py
```

### Вариант 2: Bash скрипт

```bash
cd TravelAI/backend
chmod +x curl_test_commands.sh
./curl_test_commands.sh
```

### Вариант 3: Ручное выполнение команд

Используйте команды из файла `quick_test_commands.md`

## Что добавляется

### 1. Пользователи
- **Иван Петров** (Москва) - интересы: музеи, история, архитектура
- **Мария Сидорова** (Санкт-Петербург) - интересы: спорт, горы, море
- **Алексей Козлов** (Казань) - интересы: кухня, культура, традиции

### 2. Опросы пользователей
- Детальные опросы с предпочтениями по городам
- Типы туризма (познавательный, спортивный, экзотический и др.)
- Возрастные группы и компании
- Кулинарные предпочтения

### 3. Готовые города
- **Москва** - столица России
- **Санкт-Петербург** - культурная столица
- **Казань** - столица Татарстана
- **Сочи** - курортный город
- **Екатеринбург** - столица Урала

### 4. Рейтинги городов
- Различные оценки от пользователей
- Временные метки

### 5. События аналитики
- Начало просмотра городов
- События просмотра более 2 минут

## Структура тестовых данных

### Пользователь 1 (Иван)
- **Возраст**: 25-34
- **Пол**: мужской
- **Интересы**: музеи, история, архитектура, театры, галереи
- **Предпочтения**: познавательный, культурный, этнический туризм
- **Компания**: пара
- **Кухня**: русская, итальянская

### Пользователь 2 (Мария)
- **Возраст**: 18-24
- **Пол**: женский
- **Интересы**: спорт, горы, море, экстрим, путешествия
- **Предпочтения**: спортивный, экзотический, горнолыжный туризм
- **Компания**: в одиночку
- **Кухня**: японская, итальянская, мексиканская

### Пользователь 3 (Алексей)
- **Возраст**: не указан
- **Пол**: не указан
- **Интересы**: кухня, культура, традиции, фото, блог
- **Предпочтения**: не указаны

## Тестирование API endpoints

После загрузки данных вы можете протестировать:

### Получение данных
```bash
# Все туры
curl -X GET "http://127.0.0.1:8000/tour/all"

# Популярные туры
curl -X GET "http://127.0.0.1:8000/list_popular"

# Опрос пользователя
curl -X GET "http://127.0.0.1:8000/user_survey/1"

# Рекомендации
curl -X GET "http://127.0.0.1:8000/user_recommendations/1?max_results=3"

# Рейтинги городов
curl -X GET "http://127.0.0.1:8000/user_city_ratings/1"

# Аналитика
curl -X GET "http://127.0.0.1:8000/analytics/city-view/1"
```

### Работа с избранным
```bash
# Добавить в избранное
curl -X POST "http://127.0.0.1:8000/favorites" \
  -H "Content-Type: application/json" \
  -d '{"user_id": 1, "tour_id": 1}'

# Получить избранное
curl -X GET "http://127.0.0.1:8000/users/1/favorites"

# Удалить из избранного
curl -X DELETE "http://127.0.0.1:8000/favorites" \
  -H "Content-Type: application/json" \
  -d '{"user_id": 1, "tour_id": 1}'
```

## Устранение неполадок

### Ошибка подключения к серверу
```
❌ Сервер недоступен. Убедитесь, что FastAPI сервер запущен на http://127.0.0.1:8000
```
**Решение**: Запустите FastAPI сервер:
```bash
cd TravelAI/backend
uvicorn app.main:app --reload --host 127.0.0.1 --port 8000
```

### Ошибка Redis
```
❌ Ошибка Redis: Connection refused
```
**Решение**: Запустите Redis сервер:
```bash
# macOS/Linux
redis-server

# Windows
redis-server.exe
```

### Ошибка базы данных
```
❌ Ошибка базы данных: no such table
```
**Решение**: Убедитесь, что база данных инициализирована:
```bash
cd TravelAI/backend
python -c "from app.database.database import init_db; init_db()"
```

### Ошибка user_id
```
❌ Ошибка: User not found
```
**Решение**: Сначала зарегистрируйте пользователей, затем используйте полученные ID

## Полезные команды

### Проверка статуса сервера
```bash
curl -X GET "http://127.0.0.1:8000/tests"
```

### Проверка Redis
```bash
curl -X GET "http://127.0.0.1:8000/test-redis"
```

### Документация API
Откройте в браузере: `http://127.0.0.1:8000/docs`

## Примечания

1. **ID пользователей** генерируются автоматически при регистрации
2. **ID туров** должны существовать в базе данных
3. Все данные сохраняются в SQLite базу данных
4. Кэширование работает через Redis
5. Для продакшена рекомендуется использовать PostgreSQL

## Поддержка

При возникновении проблем:
1. Проверьте логи FastAPI сервера
2. Убедитесь, что все сервисы запущены
3. Проверьте права доступа к файлам базы данных
4. Убедитесь, что порты не заняты другими процессами 